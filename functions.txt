================================================================================
MEDIA LINKS EXTENSION - FUNCTION REFERENCE
Version: 0.841
================================================================================

This file documents all JavaScript functions in the Media Links extension.
Last updated: January 5, 2026

RECENT BUG FIXES:
- Fixed stopwatch settings persistence bug where included domains and bookmarks
  would disappear after saving. The issue was a race condition in applySettingsToUI()
  where renderDomainTags() was called BEFORE the bookmarks hidden input was populated.
  Now bookmarksByDomain is populated before rendering the domain list.

- Added bookmarklet support for stopwatch notifications. When a bookmark has a
  javascript: URL, it now executes via chrome.scripting.executeScript() in the
  current tab's page context (world: 'MAIN') instead of trying to open it as a
  URL (which Chrome blocks for security).

- Created dedicated bookmarklets.js for handling all bookmarklet execution.
  Exposes MediaLinksBookmarklets API for enterprise-safe execution:
  - Uses isolated world new Function() - allowed by extension CSP
  - Has full DOM access (click buttons, check checkboxes, extract data)
  - Cannot access page JS functions (safe trade-off for enterprise)
  - stopwatch.js now uses this API instead of inline execution
  Regular bookmarks still use background script for chrome.tabs.create().

================================================================================
CORE EXTENSION FILES
================================================================================

--------------------------------------------------------------------------------
content.js - Main content script for page interactions
--------------------------------------------------------------------------------

sendSelectionUpdate(text, fromContextMenu)
  - Safely sends selected text updates to background script

createCopyModal()
  - Creates modal for selecting tabs to copy content from

showCopyFeedback(success)
  - Shows success/error feedback on copy button

createCopyWebpageButton()
  - Creates the floating copy button on pages

removeCopyWebpageButton()
  - Removes the copy button from the page

updateCopyWebpageButton(shouldShow)
  - Shows or hides copy button based on settings

initCopyWebpageButton()
  - Initializes button based on user settings

Message Handler:
  - copyPageContent: Selects all page content and returns it for multi-tab copying

Event Listeners:
  - mouseup: Sends selection to background script
  - keyup (Shift): Sends keyboard-based selection
  - contextmenu: Sends selection immediately for context menu
  - selectionchange: Debounced selection update (150ms)

--------------------------------------------------------------------------------
background.js - Background service worker
--------------------------------------------------------------------------------

generateUUID()
  - Generates unique identifiers for storage operations

createOffscreenDocument()
  - Creates offscreen document for OCR processing

extractIMDbId(url)
  - Extracts IMDb ID from URLs

extractConsolidatedIMDbData(imdbId, sendProgress)
  - Opens and extracts data from all IMDb pages (cast, crew, awards, etc.)

extractWikipediaData(tabId)
  - Extracts data from Wikipedia pages

compareData(wikipediaData, imdbData)
  - Compares data between two sources with conflict detection

broadcastThemeChange(theme)
  - Broadcasts theme changes to all open pages

updateContextMenu(selectionText, immediate)
  - Updates context menu with search options based on selection

Message Handlers:
  - createTab: Creates new tabs for data extraction
  - closeConsolidatedViewTab: Closes tabs created for consolidation
  - closeTab: Closes specific tabs
  - getTabStatus: Gets tab loading status
  - focusTab: Makes a tab active
  - sendExtractionMessage: Relays extraction message to target tab
  - getTabs: Returns list of open tabs
  - queryTabs: Filters tabs for comparison feature
  - updateTab: Updates tab URL
  - startComparison: Initiates comparison workflow
  - copyMultipleTabs: Gathers content from multiple tabs
  - getCurrentTabId: Returns sender tab ID
  - openTranscriptView: Opens YouTube transcript view page
  - focusCurrentTab: Focuses current tab and window (for stopwatch notifications)
  - openBookmarks: Opens regular URL bookmarks in new tabs (for stopwatch notifications)
    - Bookmarklets (javascript: URLs) are handled directly by stopwatch.js content script
    - Only processes regular http/https URLs
    - Opens first bookmark as active tab, rest in background
  - performOCR: Forwards OCR requests to offscreen document
  - themeChanged: Broadcasts theme changes
  - selectionChanged: Updates context menu based on text selection

Inner Functions in compareData():
  - normalizeName(name): Normalizes names for comparison (removes periods, apostrophes)
  - compareLists(listA, listB, nameField): Compares two lists of items
  - flattenIMDbData(imdbData): Flattens IMDb consolidated data into lists
  - consolidateBothSources(wikipediaData, imdbData): Unifies data format from both sources
  - compareListEnhanced(wikiList, imdbList, nameField): Enhanced comparison with conflict detection

Helper Functions:
  - getSearchUrl(query, engine): Generates search URL for query
  - getCombinations(elements, size): Generates all combinations of elements
  - generateQueries(words, profileSettings): Generates search queries from words
  - sanitizeForContextMenu(text): Sanitizes text for context menu display
  - addPendingUpdate(textToUpdate): Adds update to pending queue
  - processPendingUpdate(): Processes pending context menu updates

--------------------------------------------------------------------------------
sidebar.js - Sidebar panel management
--------------------------------------------------------------------------------

createLink(url, text)
  - Creates navigation links for sidebar

addLinks(links)
  - Adds multiple links to sidebar

getLinksForIMDb(imdbId)
  - Gets IMDb navigation links (Main, Cast, Production, Awards, etc.)

getLinksForLetterboxd(filmName)
  - Gets Letterboxd navigation links

setActiveLink()
  - Highlights current page link

updateLinks()
  - Updates links based on current page

init()
  - Initializes sidebar with event listeners

--------------------------------------------------------------------------------
bookmarklets.js - Bookmarklet execution handler
--------------------------------------------------------------------------------

Exposes: window.MediaLinksBookmarklets API

For enterprise environments with strict CSP that blocks eval/new Function,
this module automatically falls back to action-based execution.

BOOKMARKLET EXECUTION:

MediaLinksBookmarklets.execute(jsCode, title)
  - Tries eval first, falls back to action parsing if CSP blocks it
  - Parses common bookmarklet patterns into DOM actions
  - Returns: boolean (true if succeeded)

MediaLinksBookmarklets.executeFromUrl(bookmark)
  - Executes a bookmarklet from bookmark object with url and title properties
  - Parses javascript: URL and executes the code
  - Returns: boolean (true if succeeded)

MediaLinksBookmarklets.executeMultiple(bookmarks)
  - Executes multiple bookmarklets sequentially
  - Filters array to only process javascript: URLs
  - Returns: { total, executed, failed, errors[] }

MediaLinksBookmarklets.parse(bookmarkletUrl)
  - Parses a javascript: URL and returns the decoded JavaScript code
  - Handles double/triple encoded bookmarklets (decodes up to 3 times)
  - Returns: string (decoded code) or null if invalid

MediaLinksBookmarklets.isBookmarklet(url)
  - Checks if a URL is a bookmarklet (starts with javascript:)
  - Returns: boolean

DOM ACTIONS (Enterprise-Safe - No eval needed):

MediaLinksBookmarklets.action(actionConfig)
  - Executes a DOM action without eval (works even when CSP blocks eval)
  - Supported action types:
    - check: Check checkbox(es) matching selector
    - uncheck: Uncheck checkbox(es) matching selector
    - click: Click element(s) matching selector
    - setValue: Set value of input(s) matching selector
    - focus: Focus element matching selector
    - getText: Get text content of element
    - hasText: Check if page contains text
    - alert: Show an alert message
  - Config: { type, selector, value, all }
  - Returns: { success, error?, elementsModified?, text?, found? }

MediaLinksBookmarklets.parseToActions(jsCode)
  - Parses bookmarklet code into DOM actions
  - Recognizes common patterns: querySelector, checked, value, click, alert
  - Returns: array of action configs

MediaLinksBookmarklets.isEvalAvailable()
  - Checks if eval/new Function is available (not blocked by CSP)
  - Returns: boolean

--------------------------------------------------------------------------------
stopwatch.js - Time tracking on websites
--------------------------------------------------------------------------------

isExtensionContextValid()
  - Checks if extension context is still valid

isDomainIncluded()
  - Checks if current domain is in allowed list (supports wildcards)
  - Includes type validation for robustness

getBookmarksForCurrentDomain()
  - Looks up bookmarks configured for the current website domain
  - Checks exact match first, then partial matches (e.g., youtube.com matches www.youtube.com)

openSelectedBookmarks()
  - Opens bookmarks for current domain
  - Called AFTER user clicks "OK" to dismiss the notification alert (not before)
  - Only called if openBookmarksOnNotification is enabled and domain has configured bookmarks
  - Bookmarklets: Handled by bookmarklets.js (MediaLinksBookmarklets API)
  - Regular URLs: Sent to background script to open in new tabs

formatTime(ms)
  - Formats milliseconds to HH:MM:SS

getPositionStyles()
  - Returns CSS styles based on stopwatch position setting

getThemeColors()
  - Gets theme colors with computed values

loadCurrentTheme()
  - Loads user's selected theme from storage

isColorDark(hexColor)
  - Determines if a color is dark or light
  - Validates hex format, returns true (dark) for invalid colors

lightenColor(hexColor, percent)
  - Lightens a hex color by percentage
  - Validates hex format, returns #ffffff for invalid colors

darkenColor(hexColor, percent)
  - Darkens a hex color by percentage
  - Validates hex format, returns #000000 for invalid colors

createStopwatch()
  - Creates stopwatch UI element

updateStopwatchUI()
  - Updates display (expanded or minimized)

updateTime()
  - Updates time display and checks for notifications

showToastNotification(elapsed)
  - Shows alert notification and focuses tab
  - Flow: 1) Focus tab via background script, 2) Wait 150ms, 3) Show blocking alert()
  - After user clicks "OK" to dismiss alert, opens bookmarks if enabled

start()
  - Starts the stopwatch

stop()
  - Stops and removes stopwatch

loadSettings()
  - Loads stopwatch configuration

init()
  - Initializes stopwatch based on settings

--------------------------------------------------------------------------------
settings.js - Extension settings management
--------------------------------------------------------------------------------

getDefaultSettings()
  - Returns default settings object

loadSettings()
  - Loads settings from storage asynchronously

applySettingsToUI()
  - Updates UI with loaded settings

applyTheme(theme)
  - Applies theme to document

attachEventListeners()
  - Binds all form event handlers

markUnsaved()
  - Flags unsaved changes

toggleComparisonSettings(enabled)
  - Shows/hides comparison settings subsection

toggleStopwatchSettings(enabled)
  - Shows/hides stopwatch settings subsection

toggleNotificationMinutes(enabled)
  - Shows/hides notification time input

saveSettings()
  - Validates and saves all settings

resetSettings()
  - Resets all settings to defaults

showStatus(message, type)
  - Displays status messages

validateNumericInput(value, min, max, defaultVal)
  - Validates numeric inputs with bounds checking

getSeparatorValue(optionValue)
  - Converts separator option to actual string

getSeparatorOption(separatorString)
  - Converts separator string to option value

renderDomainList()
  - Renders domain list from hidden input value
  - Each domain shows bookmark configuration button and bookmark info

createDomainListItem(domain, bookmarks)
  - Creates domain list item with name, bookmark config button, and remove button
  - Shows configured bookmark count and titles if any

isValidDomainPattern(domain)
  - Validates domain format for stopwatch filter
  - Allows: domain.com, *.domain.com, domain.*, *domain*
  - Rejects: empty, invalid characters, consecutive dots

addDomain(domain)
  - Adds domain to stopwatch filter list
  - Validates domain format before adding

removeDomain(domain)
  - Removes domain from stopwatch filter list

initializeDomainTagListeners()
  - Sets up domain input event handlers

loadProfileSettings()
  - Loads search profiles from storage

initializeProfileUI(profileNum)
  - Renders search pattern profile UI

saveProfileSettings()
  - Saves current profile patterns

resetProfileSettings()
  - Resets profile to defaults

selectAllProfile()
  - Selects all patterns in current profile

deselectAllProfile()
  - Deselects all patterns in current profile

initializeSidebarNavigation()
  - Sets up sidebar scroll tracking for active state

toggleBookmarkSettings(enabled)
  - Shows/hides bookmark toggle based on notification enabled state

toggleBookmarkSelector(enabled)
  - Shows/hides bookmark selector based on open bookmarks enabled state

parseBookmarksByDomain(value)
  - Parses JSON object mapping domains to bookmark arrays from hidden input

createDomainListItem(domain, bookmarks)
  - Creates a domain list item with bookmark configuration button
  - Shows bookmark count and titles if configured

openEditSiteModal(domain, bookmarks)
  - Opens modal to configure bookmarks for a domain

openSiteBookmarkModal(domain, existingBookmarks)
  - Modal for configuring bookmarks for a specific domain
  - Shows bookmark tree browser and selected bookmarks preview

renderBookmarkNodeForSite(container, node, selectedIds, selectedBookmarks, depth, onSelectionChange)
  - Recursively renders bookmark folders and items in site configuration modal

--------------------------------------------------------------------------------
theme-manager.js - Centralized theme management
--------------------------------------------------------------------------------

isExtensionContextValid()
  - Checks if extension context is valid

loadTheme()
  - Loads theme from storage

applyThemeToDOM(theme)
  - Applies theme to document elements

initialize()
  - Initializes theme manager with message listeners

whenReady()
  - Returns promise that resolves when initialized

setTheme(theme)
  - Sets theme and notifies subscribers

getTheme()
  - Returns current theme name

getThemeColors(theme)
  - Returns color palette for theme

getDialogColorsForTheme(theme)
  - Returns dialog-specific colors

getDialogColors(buttonText)
  - Computes dialog colors based on button text

subscribe(callback)
  - Registers callback for theme changes

notifySubscribers(theme)
  - Notifies all subscribers of theme change

getAvailableThemes()
  - Returns list of all available themes

Available Themes: light, dark, catppuccin-mocha, cats, cat-night

--------------------------------------------------------------------------------
search.js - Multi-element search pattern generation
--------------------------------------------------------------------------------

loadDefaultSearchEngine()
  - Loads default search engine from settings

saveDefaultSearchEngine(engine)
  - Saves selected search engine

loadSearchFromUrl()
  - Loads search elements from URL parameters

getCombinations(elements, size)
  - Generates word combinations of specified size

getCurrentElements()
  - Gets all search input values

generateExampleQuery(pattern, exampleElements, wordCount)
  - Creates example query from pattern

getProfileSettings(profileNum)
  - Gets search patterns for profile

initializeProfileSettings(profileNum)
  - Renders profile pattern UI

selectAllInSection(profileNum, wordCount)
  - Selects all patterns in section

deselectAllInSection(profileNum, wordCount)
  - Deselects all patterns in section

updateSectionStatus(profileNum, wordCount)
  - Updates section status display

loadSettings()
  - Loads profile settings from storage

saveCurrentProfileSettings()
  - Saves current profile patterns

resetCurrentProfileSettings()
  - Resets profile to defaults

selectAllInCurrentProfile()
  - Selects all patterns in profile

deselectAllInCurrentProfile()
  - Deselects all patterns in profile

generateQueries(elements)
  - Generates all search queries from elements

getSearchUrl(query, engine)
  - Creates search URL for engine

updateSearchPreview()
  - Updates preview of generated queries

Search Engines: Google, YouTube, Google AI, Bing, DuckDuckGo

--------------------------------------------------------------------------------
settings-utils.js - Settings validation and migration
--------------------------------------------------------------------------------

isExtensionContextValid()
  - Checks if extension context is valid

validateCopyFormats(copyFormats)
  - Validates copy format settings object

validateSetting(key, value)
  - Validates individual setting by key

validateSettings(settings)
  - Validates all settings object

migrateSettings(settings)
  - Fills missing keys with defaults

loadSettings()
  - Loads all settings from storage

saveSetting(key, value)
  - Saves single setting with validation

saveSettings(settings)
  - Saves multiple settings with validation

getSetting(key)
  - Gets single setting value

getSettings(keys)
  - Gets multiple settings

resetSettings()
  - Clears all settings to defaults

getValidationRule(key)
  - Returns validation rules for setting

getDefaultSettings()
  - Returns copy of default settings

--------------------------------------------------------------------------------
comparison.js - Wikipedia/IMDb data comparison
--------------------------------------------------------------------------------

isExtensionContextValid()
  - Checks if extension context is valid

getCurrentPageInfo()
  - Extracts current page information (source, title, URL, imdbId)
  - Returns: object | null

selectComparisonTab(currentSource)
  - Opens tab selector modal for comparison
  - Parameters: currentSource (string) - 'wikipedia' or 'imdb'
  - Returns: Promise<tab object | null>

createTabSelectorModal(tabs, currentSource, callback)
  - Creates modal UI for tab selection
  - Parameters: tabs (array), currentSource (string), callback (function)

extractIMDbId(url)
  - Extracts IMDb title ID from URL
  - Parameters: url (string)
  - Returns: string | null

showComparisonStatus(message, type)
  - Creates and shows status notification
  - Parameters: message (string), type ('info'|'success'|'error')
  - Returns: HTMLElement

updateComparisonStatus(message, type)
  - Updates existing status notification
  - Parameters: message (string), type (string)

removeComparisonStatus()
  - Removes status notification with animation

setupComparisonProgressListener()
  - Sets up listener for comparison progress messages from background

initiateComparison(currentPageInfo)
  - Main function to start comparison workflow
  - Parameters: currentPageInfo (object)
  - Sends message to background script and handles progress

initComparisonButton()
  - Initializes "Compare with IMDb/Wikipedia" button on page
  - Respects user settings for button visibility

removeComparisonButton()
  - Removes comparison button from page

Features: Wikipedia-IMDb comparison, tab selection, conflict detection, progress notifications

--------------------------------------------------------------------------------
youtube-transcript-copy.js - YouTube transcript extraction
--------------------------------------------------------------------------------

isExtensionContextValid()
  - Checks if extension context is still valid

isYouTubeVideoPage()
  - Checks if current page is a YouTube video page

getVideoId()
  - Extracts video ID from URL parameters

getVideoTitle()
  - Extracts video title from page elements or meta tags

getThemeColors()
  - Gets theme colors for button styling

getCopyButtonSettings()
  - Loads transcript button visibility setting from storage

addTranscriptButton()
  - Creates and adds the transcript button to YouTube's action bar

waitForElement(selector, timeout)
  - Waits for DOM element to appear with timeout

decodeHTMLEntities(text)
  - Decodes HTML entities in text

stripTags(html)
  - Removes HTML tags from text

formatTimestamp(seconds)
  - Formats seconds to MM:SS or HH:MM:SS timestamp

getYtInitialPlayerResponse()
  - Extracts ytInitialPlayerResponse from page scripts

fetchTranscriptInnerTube(videoId)
  - Fetches transcript using YouTube's InnerTube API

fetchFromCaptionTracks(captionTracks)
  - Parses transcript from caption track XML

fetchTranscriptFromNextEndpoint(videoId)
  - Fetches transcript from /next endpoint (engagement panel)

findContinuationToken(content)
  - Finds continuation token in panel content

fetchTranscriptWithToken(token)
  - Fetches transcript using continuation token

fetchTranscriptFromPage(videoId)
  - Fallback method: fetches transcript from page HTML

extractTranscript()
  - Main extraction function, tries multiple methods

resetButton()
  - Resets button state after extraction

showNotification(message, isError)
  - Shows toast notification on page

initialize()
  - Initializes transcript button with SPA navigation handling

API Used: YouTube InnerTube API (player, next, get_transcript endpoints)
Caption Priority: English manual > English auto > Any auto > First available

--------------------------------------------------------------------------------
youtube-transcript-view.js - Transcript display page
--------------------------------------------------------------------------------

showToast(message, type)
  - Shows toast notification (success/error)

formatTime(seconds)
  - Formats seconds to MM:SS or HH:MM:SS

countWords(text)
  - Counts words in text string

escapeHtml(text)
  - Escapes HTML characters for safe display

highlightText(text, term)
  - Highlights search terms in text

loadTranscriptData()
  - Loads transcript data from chrome.storage.local

generateTranscriptText(withTimestamps)
  - Generates formatted transcript text for copying

generatePlainText()
  - Generates plain text with all segments joined

renderTranscript()
  - Main render function for transcript view

renderSegments()
  - Renders transcript segments with optional timestamps

copyTranscript()
  - Copies transcript to clipboard (with/without timestamps)

downloadTranscript()
  - Downloads transcript as .txt file

toggleTimestamps()
  - Toggles timestamp visibility

handleSearch(e)
  - Handles search input with filtering

initializeEventListeners()
  - Sets up all event listeners

Keyboard Shortcuts:
  - Ctrl/Cmd + C: Copy transcript (when not in input)
  - Ctrl/Cmd + S: Download transcript
  - Ctrl/Cmd + F: Focus search box

Features: Timestamp toggle, search/filter, copy, download, click-to-copy timestamps

--------------------------------------------------------------------------------
youtube-transcript-view.html - Transcript viewer page
--------------------------------------------------------------------------------

UI Components:
  - Header with video title and metadata
  - Transcript controls (timestamp toggle, copy, download buttons)
  - Statistics section (segments, words, duration)
  - Search box with live filtering
  - Transcript segments with clickable timestamps
  - Plain text view (hidden by default)

Theme Support: Uses CSS variables from theme-manager.js
Styles: Responsive layout, hover effects, toast notifications

================================================================================
UTILITY FILES
================================================================================

--------------------------------------------------------------------------------
date-formatting-utils.js - Shared date utilities
--------------------------------------------------------------------------------

parseDate(dateString)
  - Parses dates in multiple formats to Date object

findMonthIndex(monthStr)
  - Finds month index from month name

formatDate(date, format)
  - Formats Date object to string

parseAndFormat(dateString, outputFormat)
  - Parses and reformats date in one step

looksLikeDate(str)
  - Detects if string contains a date

getUserDateFormat()
  - Gets user's preferred date format from settings

extractYear(str)
  - Extracts year from string

Supported Formats: DD MMM YYYY, YYYY-MM-DD, MM/DD/YYYY, DD/MM/YYYY, MMM DD YYYY

--------------------------------------------------------------------------------
customized-views.js - Reusable view components
--------------------------------------------------------------------------------

CustomizedView Class:
  constructor(options)
    - Initializes view with data and options

  setupDropdownCleanupObserver()
    - Sets up DOM observers for cleanup

  destroy()
    - Cleans up listeners and observers

  getAvailableRoles()
    - Gets unique roles in data

  render()
    - Renders sortable table view

  setupCopyDropdown(cell, columnName)
    - Creates copy dropdown menu

  setupRoleFilter()
    - Creates role filter UI

  setupSearch()
    - Creates search input

  handleCopy(text)
    - Copies text to clipboard

Features: Sortable tables, searchable data, role filtering, copy-to-clipboard

================================================================================
PLATFORM-SPECIFIC CAST COPY SCRIPTS
================================================================================

imdb-cast-copy.js
wiki-cast-copy.js
letterboxd-cast-copy.js
appletv-cast-copy.js
airtelxstream-cast-copy.js
bookmyshow-copy.js

Common Functions:
  extractCastData()
    - Scrapes cast information from page

  formatCastOutput(format)
    - Formats data based on user preference

  copyCastToClipboard()
    - Copies formatted cast list

================================================================================
ADDITIONAL FILES
================================================================================

offscreen.js
  - Offscreen document for OCR processing (Tesseract.js)

hotstar-auto-view-more.js
  - Auto-expanding content on Hotstar

hotstar-episode-copy.js / hotstar-show-title-copy.js
  - Hotstar-specific data extraction

imdb-customized-views.js / wiki-customized-views.js / appletv-customized-views.js
  - Platform-specific customized view implementations

consolidated-view-page.js
  - Dedicated view page for consolidated IMDb data

comparison-view-page.js
  - Dedicated view page for Wikipedia/IMDb comparisons

cbfc-ocr.js / cbfc-fix.js
  - CBFC certificate OCR and processing

youtube-transcript-copy.js / youtube-transcript-view.js / youtube-transcript-view.html
  - YouTube transcript extraction and viewing system

================================================================================
CONSTANTS & CONFIGURATIONS
================================================================================

groupingPatterns (background.js)
  - Patterns for 1-4 word grouping combinations
  - Example: 2 words can be "word1 | word2" or "word1-word2"

patternDescriptions (background.js, settings.js, search.js)
  - Search pattern templates for each word count (1-4)
  - Templates: plain, quoted, intitle, allintitle, intext, phrase, and/or

defaultPatterns (background.js, settings.js, search.js)
  - Default enabled patterns per word count

themeColors/themeColorPalettes (theme-manager.js, stopwatch.js)
  - Color definitions for themes:
    - light: Default web colors
    - dark: Dark mode
    - catppuccin-mocha: Community theme
    - cats: Custom cat-themed
    - cat-night: Dark cat theme

DEFAULT_SETTINGS (settings-utils.js)
  - All default extension settings (50+ settings)
  - Includes stopwatchOpenBookmarksOnNotification (boolean, default: false)
  - Includes stopwatchBookmarksByDomain (object mapping domains to bookmark arrays)

VALIDATION_RULES (settings-utils.js)
  - Type and constraint validation for all settings
  - Supports: string, number, boolean, array, object types
  - Validates: enums, min/max values

INNERTUBE_API_KEY, INNERTUBE_CLIENT_VERSION (youtube-transcript-copy.js)
  - YouTube InnerTube API configuration for transcript extraction

Queue Constants (background.js)
  - MAX_PENDING_UPDATES: 50 (prevents unbounded growth)
  - UPDATE_TIMEOUT: 5 minutes (auto-clean old updates)

================================================================================
ARCHITECTURE NOTES
================================================================================

Message Flow:
1. Content scripts detect user actions (selection, clicks)
2. Messages sent to background.js for processing
3. Background coordinates tab operations and data extraction
4. Results returned to content scripts or stored
5. Theme changes broadcast to all scripts
6. Settings changes automatically sync across extension

Storage:
- chrome.storage.sync: User settings (limited to 100KB)
- chrome.storage.local: Temporary data (YouTube transcripts, comparison data)
- SettingsUtils: Handles validation, migration, and defaults
- ThemeManager: Centralized theme state with subscriber pattern

Key Patterns:
- Profile-based search patterns (1-4 word combinations)
- Multiple date formats supported
- Theme system with 5 themes and subscriber notifications
- Domain filtering with wildcard support (*.example.com, *keyword*)
- Format options for cast/crew copying (newline, comma, CSV, JSON, table)
- YouTube transcript extraction via InnerTube API
- UUID-based storage keys prevent concurrent operation conflicts

Extension Context Safety:
- All scripts check isExtensionContextValid() before chrome API calls
- Graceful degradation when context is invalidated
- Try-finally blocks ensure cleanup of storage keys

Tab Management:
- Staggered tab opening (300ms intervals) prevents rate limiting
- Polling mechanism for data extraction (500ms checks, max 60 seconds)
- Automatic tab cleanup after extraction

Security Measures:
- textContent preferred over innerHTML for user data
- Safe string replacement (split-join instead of regex with user input)
- Tab ID validation before processing
- Context menu text sanitization (50 char limit, special chars removed)

================================================================================
